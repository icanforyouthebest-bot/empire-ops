name: Setup Secretary Bot

on:
  workflow_dispatch:

jobs:
  setup:
    name: Register Telegram Webhook
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Deploy secretary-bot edge function
        env:
          SUPABASE_ACCESS_TOKEN: ${{ secrets.SUPABASE_ACCESS_TOKEN }}
        run: |
          npx supabase functions deploy secretary-bot --project-ref vmyrivxxibqydccurxug

      - name: Register Telegram Webhook
        shell: pwsh
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        run: pwsh scripts/ai-governance/setup-secretary-bot.ps1
